#!/bin/sh

findLuaInclude() {
    VERSION=$1
    PATH=$2
    FILE=`/usr/bin/find $PATH -name luaconf.h | /usr/bin/grep $VERSION`
    if [ x$FILE != 'x' ]; then
        PATH=`/usr/bin/dirname $FILE`
        echo $PATH
    fi
}

findLuaLib() {
    VERSION=$1
    PATH=$2
    FILE=`/usr/bin/find $PATH -name "liblua$VERSION.so"`
    if [ x$FILE != 'x' ]; then
        PATH=`/usr/bin/dirname $FILE`
        echo $PATH
    fi
}

findLuaBin() {
    VERSION=$1
    PATH=$2
    PATH=`/usr/bin/find $PATH -type f -name "lua$VERSION"`
    if [ x$PATH != 'x' ]; then
        echo $PATH
    fi
}

writeLuaInclude() {
    VERSION=$1
    INCPATH=$2
    LIBPATH=$3
    BINPATH=$4
    echo "LUAVER   := $VERSION" > Lua.inc
    echo "LUAINC   := $INCPATH" >> Lua.inc
    echo "LUALIBDIR:= $LIBPATH" >> Lua.inc
    echo "LUABIN   := $BINPATH" >> Lua.inc
}

SEARCHPATH=/usr
for VERSION in 5.4 5.3 5.2; do
    INCPATH=`findLuaInclude $VERSION $SEARCHPATH`
    LIBPATH=`findLuaLib $VERSION $SEARCHPATH`
    BINPATH=`findLuaBin $VERSION $SEARCHPATH`
    if [ x$INCPATH != 'x' ] && [ x$LIBPATH != 'x' ]; then
        writeLuaInclude $VERSION $INCPATH $LIBPATH $BINPATH
        exit 0
    fi
done

echo "Lua installation (version 5.2,5.3 or 5.4) not found!"
exit 1

